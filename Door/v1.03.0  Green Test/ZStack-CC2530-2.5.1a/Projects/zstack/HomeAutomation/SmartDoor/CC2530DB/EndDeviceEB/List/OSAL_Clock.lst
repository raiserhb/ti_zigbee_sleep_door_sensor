###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.1.10194/W32 for 8051         08/Aug/2017  09:57:18 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  D:\work space\Smart Product\Two YHY\Door\v1.03.0   #
#                          Green\ZStack-CC2530-2.5.1a\COMPONENTS\osal\common\ #
#                          OSAL_Clock.c                                       #
#    Command line       =  -f "D:\work space\Smart Product\Two                #
#                          YHY\Door\v1.03.0  Green\ZStack-CC2530-2.5.1a\Proje #
#                          cts\zstack\HomeAutomation\SmartDoor\CC2530DB\..\To #
#                          ols\CC2530DB\f8wEndev.cfg" (-DCPU32MHZ             #
#                          -DROOT=__near_func -DMAC_CFG_TX_DATA_MAX=3         #
#                          -DMAC_CFG_TX_MAX=6 -DMAC_CFG_RX_MAX=3              #
#                          -DHAL_KEY=FALSE -DHAL_LED=FALSE -DHAL_LCD=FALSE    #
#                          -DHAL_ADC=FALSE -DNV_RESTORE -DNV_INIT             #
#                          -DPOWER_SAVING -DTC_LINKKEY_JOIN) -f "D:\work      #
#                          space\Smart Product\Two YHY\Door\v1.03.0           #
#                          Green\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAut #
#                          omation\SmartDoor\CC2530DB\..\Tools\CC2530DB\f8wCo #
#                          nfig.cfg" (-DZIGBEEPRO -DSECURE=1                  #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x06108800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4                        #
#                          -DDEFAULT_KEY={0x58,0x69,0x6E,0x67,0x48,0x75,0x6F, #
#                          0x59,0x75,0x61,0x6E,0x53,0x6D,0x61,0x72,0x74}      #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=0           #
#                          -DQUEUED_POLL_RATE=0 -DRESPONSE_POLL_RATE=0        #
#                          -DREJOIN_POLL_RATE=440) -f "D:\work space\Smart    #
#                          Product\Two YHY\Door\v1.03.0                       #
#                          Green\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAut #
#                          omation\SmartDoor\CC2530DB\..\Tools\CC2530DB\f8wZC #
#                          L.cfg" (-DZCL_READ -DZCL_WRITE -DZCL_REPORT        #
#                          -DZCL_BASIC -DZCL_IDENTIFY -DZCL_ON_OFF            #
#                          -DZCL_KEY_ESTABLISH -DZCL_KEY_ESTABLISHMENT_KEY_GE #
#                          NERATE_TIMEOUT=4 -DZCL_KEY_ESTABLISHMENT_MAC_GENER #
#                          ATE_TIMEOUT=10 -DZCL_KEY_ESTABLISHMENT_EKEY_GENERA #
#                          TE_TIMEOUT=10 -DZCL_LOAD_CONTROL                   #
#                          -DZCL_SIMPLE_METERING -DZCL_PRICING -DZCL_MESSAGE  #
#                          -DZCL_TUNNELING -DZCL_TOU) -DZCL_DEVICE_MGMT       #
#                          "D:\work space\Smart Product\Two YHY\Door\v1.03.0  #
#                           Green\ZStack-CC2530-2.5.1a\COMPONENTS\osal\common #
#                          \OSAL_Clock.c" -lC "D:\work space\Smart            #
#                          Product\Two YHY\Door\v1.03.0                       #
#                          Green\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAut #
#                          omation\SmartDoor\CC2530DB\EndDeviceEB\List\" -lA  #
#                          "D:\work space\Smart Product\Two YHY\Door\v1.03.0  #
#                           Green\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAu #
#                          tomation\SmartDoor\CC2530DB\EndDeviceEB\List\"     #
#                          --diag_suppress Pe001,Pa010 -o "D:\work            #
#                          space\Smart Product\Two YHY\Door\v1.03.0           #
#                          Green\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAut #
#                          omation\SmartDoor\CC2530DB\EndDeviceEB\Obj\" -e    #
#                          --debug --core=plain --dptr=16,1                   #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I "D:\work space\Smart Product\Two                #
#                          YHY\Door\v1.03.0  Green\ZStack-CC2530-2.5.1a\Proje #
#                          cts\zstack\HomeAutomation\SmartDoor\CC2530DB\" -I  #
#                          "D:\work space\Smart Product\Two YHY\Door\v1.03.0  #
#                           Green\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAu #
#                          tomation\SmartDoor\CC2530DB\..\Source\" -I         #
#                          "D:\work space\Smart Product\Two YHY\Door\v1.03.0  #
#                           Green\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAu #
#                          tomation\SmartDoor\CC2530DB\..\..\Source\" -I      #
#                          "D:\work space\Smart Product\Two YHY\Door\v1.03.0  #
#                           Green\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAu #
#                          tomation\SmartDoor\CC2530DB\..\..\..\ZMain\TI2530D #
#                          B\" -I "D:\work space\Smart Product\Two            #
#                          YHY\Door\v1.03.0  Green\ZStack-CC2530-2.5.1a\Proje #
#                          cts\zstack\HomeAutomation\SmartDoor\CC2530DB\..\.. #
#                          \..\..\..\Components\hal\include\" -I "D:\work     #
#                          space\Smart Product\Two YHY\Door\v1.03.0           #
#                          Green\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAut #
#                          omation\SmartDoor\CC2530DB\..\..\..\..\..\Componen #
#                          ts\hal\target\CC2530EB\" -I "D:\work space\Smart   #
#                          Product\Two YHY\Door\v1.03.0                       #
#                          Green\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAut #
#                          omation\SmartDoor\CC2530DB\..\..\..\..\..\Componen #
#                          ts\mac\include\" -I "D:\work space\Smart           #
#                          Product\Two YHY\Door\v1.03.0                       #
#                          Green\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAut #
#                          omation\SmartDoor\CC2530DB\..\..\..\..\..\Componen #
#                          ts\mac\high_level\" -I "D:\work space\Smart        #
#                          Product\Two YHY\Door\v1.03.0                       #
#                          Green\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAut #
#                          omation\SmartDoor\CC2530DB\..\..\..\..\..\Componen #
#                          ts\mac\low_level\srf04\" -I "D:\work space\Smart   #
#                          Product\Two YHY\Door\v1.03.0                       #
#                          Green\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAut #
#                          omation\SmartDoor\CC2530DB\..\..\..\..\..\Componen #
#                          ts\mac\low_level\srf04\single_chip\" -I "D:\work   #
#                          space\Smart Product\Two YHY\Door\v1.03.0           #
#                          Green\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAut #
#                          omation\SmartDoor\CC2530DB\..\..\..\..\..\Componen #
#                          ts\mt\" -I "D:\work space\Smart Product\Two        #
#                          YHY\Door\v1.03.0  Green\ZStack-CC2530-2.5.1a\Proje #
#                          cts\zstack\HomeAutomation\SmartDoor\CC2530DB\..\.. #
#                          \..\..\..\Components\osal\include\" -I "D:\work    #
#                          space\Smart Product\Two YHY\Door\v1.03.0           #
#                          Green\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAut #
#                          omation\SmartDoor\CC2530DB\..\..\..\..\..\Componen #
#                          ts\services\saddr\" -I "D:\work space\Smart        #
#                          Product\Two YHY\Door\v1.03.0                       #
#                          Green\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAut #
#                          omation\SmartDoor\CC2530DB\..\..\..\..\..\Componen #
#                          ts\services\sdata\" -I "D:\work space\Smart        #
#                          Product\Two YHY\Door\v1.03.0                       #
#                          Green\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAut #
#                          omation\SmartDoor\CC2530DB\..\..\..\..\..\Componen #
#                          ts\stack\af\" -I "D:\work space\Smart Product\Two  #
#                          YHY\Door\v1.03.0  Green\ZStack-CC2530-2.5.1a\Proje #
#                          cts\zstack\HomeAutomation\SmartDoor\CC2530DB\..\.. #
#                          \..\..\..\Components\stack\nwk\" -I "D:\work       #
#                          space\Smart Product\Two YHY\Door\v1.03.0           #
#                          Green\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAut #
#                          omation\SmartDoor\CC2530DB\..\..\..\..\..\Componen #
#                          ts\stack\sapi\" -I "D:\work space\Smart            #
#                          Product\Two YHY\Door\v1.03.0                       #
#                          Green\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAut #
#                          omation\SmartDoor\CC2530DB\..\..\..\..\..\Componen #
#                          ts\stack\sec\" -I "D:\work space\Smart             #
#                          Product\Two YHY\Door\v1.03.0                       #
#                          Green\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAut #
#                          omation\SmartDoor\CC2530DB\..\..\..\..\..\Componen #
#                          ts\stack\sys\" -I "D:\work space\Smart             #
#                          Product\Two YHY\Door\v1.03.0                       #
#                          Green\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAut #
#                          omation\SmartDoor\CC2530DB\..\..\..\..\..\Componen #
#                          ts\stack\zcl\" -I "D:\work space\Smart             #
#                          Product\Two YHY\Door\v1.03.0                       #
#                          Green\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAut #
#                          omation\SmartDoor\CC2530DB\..\..\..\..\..\Componen #
#                          ts\stack\zdo\" -I "D:\work space\Smart             #
#                          Product\Two YHY\Door\v1.03.0                       #
#                          Green\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAut #
#                          omation\SmartDoor\CC2530DB\..\..\..\..\..\Componen #
#                          ts\zmac\" -I "D:\work space\Smart Product\Two      #
#                          YHY\Door\v1.03.0  Green\ZStack-CC2530-2.5.1a\Proje #
#                          cts\zstack\HomeAutomation\SmartDoor\CC2530DB\..\.. #
#                          \..\..\..\Components\zmac\f8w\" -Oh                #
#                          --require_prototypes                               #
#    List file          =  D:\work space\Smart Product\Two YHY\Door\v1.03.0   #
#                          Green\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAut #
#                          omation\SmartDoor\CC2530DB\EndDeviceEB\List\OSAL_C #
#                          lock.lst                                           #
#    Object file        =  D:\work space\Smart Product\Two YHY\Door\v1.03.0   #
#                          Green\ZStack-CC2530-2.5.1a\Projects\zstack\HomeAut #
#                          omation\SmartDoor\CC2530DB\EndDeviceEB\Obj\OSAL_Cl #
#                          ock.r51                                            #
#                                                                             #
#                                                                             #
###############################################################################

D:\work space\Smart Product\Two YHY\Door\v1.03.0  Green\ZStack-CC2530-2.5.1a\COMPONENTS\osal\common\OSAL_Clock.c
      1          /******************************************************************************
      2            Filename:       OSAL_Clock.c
      3            Revised:        $Date: 2012-03-02 15:52:01 -0800 (Fri, 02 Mar 2012) $
      4            Revision:       $Revision: 29608 $
      5          
      6            Description:    OSAL Clock definition and manipulation functions.
      7          
      8            Copyright 2008-2012 Texas Instruments Incorporated. All rights reserved.
      9          
     10            IMPORTANT: Your use of this Software is limited to those specific rights
     11            granted under the terms of a software license agreement between the user
     12            who downloaded the software, his/her employer (which must be your employer)
     13            and Texas Instruments Incorporated (the "License"). You may not use this
     14            Software unless you agree to abide by the terms of the License. The License
     15            limits your use, and you acknowledge, that the Software may not be modified,
     16            copied or distributed unless embedded on a Texas Instruments microcontroller
     17            or used solely and exclusively in conjunction with a Texas Instruments radio
     18            frequency transceiver, which is integrated into your product. Other than for
     19            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     20            works of, modify, distribute, perform, display or sell this Software and/or
     21            its documentation for any purpose.
     22          
     23            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     24            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     25            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     26            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     27            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     28            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     29            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     30            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     31            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     32            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     33            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     34          
     35            Should you have any questions regarding your right to use this Software,
     36            contact Texas Instruments Incorporated at www.TI.com.
     37          ******************************************************************************/
     38          
     39          /*********************************************************************
     40           * INCLUDES
     41           */
     42          
     43          #include "comdef.h"
     44          #include "OnBoard.h"

   \                                 In  segment SFR_AN, at 0xa8
   \   union <unnamed> volatile __sfr _A_IEN0
   \                     _A_IEN0:
   \   000000                DS 1
     45          #include "OSAL.h"
     46          #include "OSAL_Clock.h"
     47          
     48          /*********************************************************************
     49           * MACROS
     50           */
     51          
     52          #define	YearLength(yr)	((uint16)(IsLeapYear(yr) ? 366 : 365))
     53          
     54          /*********************************************************************
     55           * CONSTANTS
     56           */
     57          
     58          #define	BEGYEAR  2000     //  UTC started at 00:00:00 January 1, 2000
     59          
     60          #define	DAY      86400UL  // 24 hours * 60 minutes * 60 seconds
     61          
     62          /*********************************************************************
     63           * TYPEDEFS
     64           */
     65          
     66          /*********************************************************************
     67           * GLOBAL VARIABLES
     68           */
     69          
     70          /*********************************************************************
     71           * EXTERNAL VARIABLES
     72           */
     73          
     74          /*********************************************************************
     75           * EXTERNAL FUNCTIONS
     76           */
     77          extern uint32 macMcuPrecisionCount(void);
     78          
     79          #if (defined HAL_MCU_CC2430) || (defined HAL_MCU_CC2530) || (defined HAL_MCU_CC2533)
     80          
     81            /*  This function is used to divide a 31 bit dividend by a 16 bit
     82             *  divisor and return a packed 16 bit quotient and 16 bit
     83             *  remainder.
     84             *
     85             *  Note: This routine takes ~25.6us @32MHz. With C overhead, the
     86             *        time is ~32us.
     87             *
     88             *  dividend - 31 bit dividend.
     89             *  divisor - 16 bit divisor.
     90             *
     91             *  return - MSW divisor; LSW quotient
     92             */
     93            extern __near_func uint32 osalMcuDivide31By16To16( uint32 dividend, uint16 divisor );
     94          
     95            #define CONVERT_320US_TO_MS_ELAPSED_REMAINDER( x, y, z ) st( \
     96                                                                         \
     97              /* The 16 bit quotient is in MSW and */                    \
     98              /* the 16 bit remainder is in LSW. */                      \
     99              x = osalMcuDivide31By16To16( x, 25 );                      \
    100                                                                         \
    101              /* Add quotient to y */                                    \
    102              y += (x >> 16);                                            \
    103                                                                         \
    104              /* Copy remainder to z */                                  \
    105              z = (uint16)(x & 0x0FFFF);                                 \
    106            )
    107          
    108          #else /* (defined HAL_MCU_CC2430) || (defined HAL_MCU_CC2530) || (defined HAL_MCU_CC2533) */
    109          
    110            #define CONVERT_320US_TO_MS_ELAPSED_REMAINDER( x, y, z ) st( \
    111              y += x / 25;                                               \
    112              z = x % 25;                                                \
    113            )
    114          
    115          #endif /* (defined HAL_MCU_CC2430) || (defined HAL_MCU_CC2530) || (defined HAL_MCU_CC2533) */
    116          
    117          /*********************************************************************
    118           * LOCAL VARIABLES
    119           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    120          static uint32 previousMacTimerTick = 0;
   \                     previousMacTimerTick:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    121          static uint16 remUsTicks = 0;
   \                     remUsTicks:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    122          static uint16 timeMSec = 0;
   \                     timeMSec:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    123          
    124          // number of seconds since 0 hrs, 0 minutes, 0 seconds, on the
    125          // 1st of January 2000 UTC

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    126          UTCTime OSAL_timeSeconds = 0;
   \                     OSAL_timeSeconds:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z
    127          
    128          /*********************************************************************
    129           * LOCAL FUNCTION PROTOTYPES
    130           */
    131          static uint8 monthLength( uint8 lpyr, uint8 mon );
    132          
    133          static void osalClockUpdate( uint16 elapsedMSec );
    134          
    135          /*********************************************************************
    136           * FUNCTIONS
    137           *********************************************************************/
    138          
    139          /*********************************************************************
    140           * @fn      osalTimeUpdate
    141           *
    142           * @brief   Uses the free running rollover count of the MAC backoff timer;
    143           *          this timer runs freely with a constant 320 usec interval.  The
    144           *          count of 320-usec ticks is converted to msecs and used to update
    145           *          the OSAL clock and Timers by invoking osalClockUpdate() and
    146           *          osalTimerUpdate().  This function is intended to be invoked
    147           *          from the background, not interrupt level.
    148           *
    149           * @param   None.
    150           *
    151           * @return  None.
    152           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    153          void osalTimeUpdate( void )
   \                     osalTimeUpdate:
    154          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
    155            halIntState_t intState;
    156            uint32 tmp;
    157            uint32 ticks320us;
    158            uint16 elapsedMSec = 0;
    159          
    160            HAL_ENTER_CRITICAL_SECTION(intState);
   \   000005   E5A8         MOV     A,0xa8
   \   000007   FE           MOV     R6,A
   \   000008   C2AF         CLR     0xa8.7
    161            // Get the free-running count of 320us timer ticks
    162            tmp = macMcuPrecisionCount();
   \   00000A                ; Setup parameters for call to function macMcuPrecisionCount
   \   00000A   12....       LCALL   ??macMcuPrecisionCount?relay
   \   00000D   8A..         MOV     ?V0 + 0,R2
   \   00000F   8B..         MOV     ?V0 + 1,R3
   \   000011   8C..         MOV     ?V0 + 2,R4
   \   000013   8D..         MOV     ?V0 + 3,R5
    163            HAL_EXIT_CRITICAL_SECTION(intState);
   \   000015   EE           MOV     A,R6
   \   000016   A2E7         MOV     C,0xE0 /* A   */.7
   \   000018   92AF         MOV     0xa8.7,C
    164            
    165            if ( tmp != previousMacTimerTick )
   \   00001A   90....       MOV     DPTR,#previousMacTimerTick
   \   00001D   78..         MOV     R0,#?V0 + 0
   \   00001F   12....       LCALL   ?L_EQ_X
   \   000022   7003         JNZ     $+5
   \   000024   02....       LJMP    ??osalTimeUpdate_0 & 0xFFFF
    166            {
    167              // Calculate the elapsed ticks of the free-running timer.
    168              ticks320us = (tmp - previousMacTimerTick) & 0xffffffffu;
   \   000027   8A..         MOV     ?V0 + 4,R2
   \   000029   8B..         MOV     ?V0 + 5,R3
   \   00002B   8C..         MOV     ?V0 + 6,R4
   \   00002D   8D..         MOV     ?V0 + 7,R5
   \   00002F   90....       MOV     DPTR,#previousMacTimerTick
   \   000032   78..         MOV     R0,#?V0 + 4
   \   000034   12....       LCALL   ?L_SUB_X
    169          
    170              // Store the MAC Timer tick count for the next time through this function.
    171              previousMacTimerTick = tmp;
   \   000037   90....       MOV     DPTR,#previousMacTimerTick
   \   00003A   78..         MOV     R0,#?V0 + 0
   \   00003C   12....       LCALL   ?L_MOV_TO_X
    172              
    173              // update converted number with remaining ticks from loop and the
    174              // accumulated remainder from loop
    175              tmp = (ticks320us * 8) + remUsTicks;
    176          
    177              // Convert the 320 us ticks into milliseconds and a remainder
    178              CONVERT_320US_TO_MS_ELAPSED_REMAINDER( tmp, elapsedMSec, remUsTicks );
   \   00003F                ; Setup parameters for call to function osalMcuDivide31By16To16
   \   00003F   75..19       MOV     ?V0 + 0,#0x19
   \   000042   75..00       MOV     ?V0 + 1,#0x0
   \   000045   78..         MOV     R0,#?V0 + 0
   \   000047   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00004A   7403         MOV     A,#0x3
   \   00004C   78..         MOV     R0,#?V0 + 4
   \   00004E   12....       LCALL   ?L_SHL
   \   000051   90....       MOV     DPTR,#remUsTicks
   \   000054   E0           MOVX    A,@DPTR
   \   000055   F5..         MOV     ?V0 + 0,A
   \   000057   A3           INC     DPTR
   \   000058   E0           MOVX    A,@DPTR
   \   000059   F5..         MOV     ?V0 + 1,A
   \   00005B   E4           CLR     A
   \   00005C   F5..         MOV     ?V0 + 2,A
   \   00005E   F5..         MOV     ?V0 + 3,A
   \   000060   78..         MOV     R0,#?V0 + 4
   \   000062   79..         MOV     R1,#?V0 + 0
   \   000064   12....       LCALL   ?L_ADD
   \   000067   AA..         MOV     R2,?V0 + 4
   \   000069   AB..         MOV     R3,?V0 + 5
   \   00006B   AC..         MOV     R4,?V0 + 6
   \   00006D   AD..         MOV     R5,?V0 + 7
   \   00006F   12....       LCALL   osalMcuDivide31By16To16 & 0xFFFF
   \   000072   7402         MOV     A,#0x2
   \   000074   12....       LCALL   ?DEALLOC_XSTACK8
   \   000077   90....       MOV     DPTR,#remUsTicks
   \   00007A   EA           MOV     A,R2
   \   00007B   F0           MOVX    @DPTR,A
   \   00007C   A3           INC     DPTR
   \   00007D   EB           MOV     A,R3
   \   00007E   F0           MOVX    @DPTR,A
    179          
    180              // Update OSAL Clock and Timers
    181              if ( elapsedMSec )
   \   00007F   EC           MOV     A,R4
   \   000080   4D           ORL     A,R5
   \   000081   603E         JZ      ??osalTimeUpdate_0
    182              {
    183                osalClockUpdate( elapsedMSec );
   \   000083   90....       MOV     DPTR,#timeMSec
   \   000086   E0           MOVX    A,@DPTR
   \   000087   2C           ADD     A,R4
   \   000088   F0           MOVX    @DPTR,A
   \   000089   A3           INC     DPTR
   \   00008A   E0           MOVX    A,@DPTR
   \   00008B   3D           ADDC    A,R5
   \   00008C   F0           MOVX    @DPTR,A
   \   00008D   90....       MOV     DPTR,#timeMSec
   \   000090   C3           CLR     C
   \   000091   E0           MOVX    A,@DPTR
   \   000092   94E8         SUBB    A,#-0x18
   \   000094   A3           INC     DPTR
   \   000095   E0           MOVX    A,@DPTR
   \   000096   9403         SUBB    A,#0x3
   \   000098   4020         JC      ??osalTimeUpdate_1
   \   00009A   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   00009D   12....       LCALL   ?US_DIV_MOD
   \   0000A0   88..         MOV     ?V0 + 0,R0
   \   0000A2   89..         MOV     ?V0 + 1,R1
   \   0000A4   90....       MOV     DPTR,#OSAL_timeSeconds
   \   0000A7   78..         MOV     R0,#?V0 + 0
   \   0000A9   12....       LCALL   ?L_ADD_TO_X
   \   0000AC   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   0000AF   12....       LCALL   ?US_DIV_MOD
   \   0000B2   90....       MOV     DPTR,#timeMSec
   \   0000B5   EA           MOV     A,R2
   \   0000B6   F0           MOVX    @DPTR,A
   \   0000B7   A3           INC     DPTR
   \   0000B8   EB           MOV     A,R3
   \   0000B9   F0           MOVX    @DPTR,A
    184                osalTimerUpdate( elapsedMSec );
   \                     ??osalTimeUpdate_1:
   \   0000BA                ; Setup parameters for call to function osalTimerUpdate
   \   0000BA   EC           MOV     A,R4
   \   0000BB   FA           MOV     R2,A
   \   0000BC   ED           MOV     A,R5
   \   0000BD   FB           MOV     R3,A
   \   0000BE   12....       LCALL   ??osalTimerUpdate?relay
    185              }
    186            }
    187          }
   \                     ??osalTimeUpdate_0:
   \   0000C1   7F08         MOV     R7,#0x8
   \   0000C3   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   0000C6                REQUIRE _A_IEN0
    188          
    189          /*********************************************************************
    190           * @fn      osalClockUpdate
    191           *
    192           * @brief   Updates the OSAL Clock time with elapsed milliseconds.
    193           *
    194           * @param   elapsedMSec - elapsed milliseconds
    195           *
    196           * @return  none
    197           */
    198          static void osalClockUpdate( uint16 elapsedMSec )
    199          {
    200            // Add elapsed milliseconds to the saved millisecond portion of time
    201            timeMSec += elapsedMSec;
    202          
    203            // Roll up milliseconds to the number of seconds
    204            if ( timeMSec >= 1000 )
    205            {
    206              OSAL_timeSeconds += timeMSec / 1000;
    207              timeMSec = timeMSec % 1000;
    208            }
    209          }
    210          
    211          /*********************************************************************
    212           * @fn      osal_setClock
    213           *
    214           * @brief   Set the new time.  This will only set the seconds portion
    215           *          of time and doesn't change the factional second counter.
    216           *
    217           * @param   newTime - number of seconds since 0 hrs, 0 minutes,
    218           *                    0 seconds, on the 1st of January 2000 UTC
    219           *
    220           * @return  none
    221           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    222          void osal_setClock( UTCTime newTime )
   \                     osal_setClock:
    223          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
   \   000009   8C..         MOV     ?V0 + 2,R4
   \   00000B   8D..         MOV     ?V0 + 3,R5
    224            OSAL_timeSeconds = newTime;
   \   00000D   90....       MOV     DPTR,#OSAL_timeSeconds
   \   000010   78..         MOV     R0,#?V0 + 0
   \   000012   12....       LCALL   ?L_MOV_TO_X
    225          }
   \   000015   7F04         MOV     R7,#0x4
   \   000017   02....       LJMP    ?BANKED_LEAVE_XDATA
    226          
    227          /*********************************************************************
    228           * @fn      osal_getClock
    229           *
    230           * @brief   Gets the current time.  This will only return the seconds
    231           *          portion of time and doesn't include the factional second
    232           *          counter.
    233           *
    234           * @param   none
    235           *
    236           * @return  number of seconds since 0 hrs, 0 minutes, 0 seconds,
    237           *          on the 1st of January 2000 UTC
    238           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    239          UTCTime osal_getClock( void )
   \                     osal_getClock:
    240          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    241            return ( OSAL_timeSeconds );
   \   000004   90....       MOV     DPTR,#OSAL_timeSeconds
   \   000007   12....       LCALL   ?XLOAD_R2345
   \   00000A   D083         POP     DPH
   \   00000C   D082         POP     DPL
   \   00000E   02....       LJMP    ?BRET
    242          }
    243          
    244          /*********************************************************************
    245           * @fn      osal_ConvertUTCTime
    246           *
    247           * @brief   Converts UTCTime to UTCTimeStruct
    248           *
    249           * @param   tm - pointer to breakdown struct
    250           *
    251           * @param   secTime - number of seconds since 0 hrs, 0 minutes,
    252           *          0 seconds, on the 1st of January 2000 UTC
    253           *
    254           * @return  none
    255           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    256          void osal_ConvertUTCTime( UTCTimeStruct *tm, UTCTime secTime )
   \                     osal_ConvertUTCTime:
    257          {
   \   000000   74E8         MOV     A,#-0x18
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 24
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FC           MOV     R4,A
   \   000007   EB           MOV     A,R3
   \   000008   FD           MOV     R5,A
   \   000009   7418         MOV     A,#0x18
   \   00000B   12....       LCALL   ?XSTACK_DISP0_8
   \   00000E   78..         MOV     R0,#?V0 + 4
   \   000010   12....       LCALL   ?L_MOV_X
    258            // calculate the time less than a day - hours, minutes, seconds
    259            {
    260              uint32 day = secTime % DAY;
   \   000013   85....       MOV     ?V0 + 0,?V0 + 4
   \   000016   85....       MOV     ?V0 + 1,?V0 + 5
   \   000019   85....       MOV     ?V0 + 2,?V0 + 6
   \   00001C   85....       MOV     ?V0 + 3,?V0 + 7
   \   00001F   90....       MOV     DPTR,#__Constant_15180
   \   000022   78..         MOV     R0,#?V0 + 8
   \   000024   12....       LCALL   ?L_MOV_X
   \   000027   78..         MOV     R0,#?V0 + 0
   \   000029   79..         MOV     R1,#?V0 + 8
   \   00002B   12....       LCALL   ?UL_DIV_MOD
    261              tm->seconds = day % 60UL;
   \   00002E   85....       MOV     ?V0 + 0,?V0 + 8
   \   000031   85....       MOV     ?V0 + 1,?V0 + 9
   \   000034   85....       MOV     ?V0 + 2,?V0 + 10
   \   000037   85....       MOV     ?V0 + 3,?V0 + 11
   \   00003A   90....       MOV     DPTR,#__Constant_3c
   \   00003D   78..         MOV     R0,#?V0 + 12
   \   00003F   12....       LCALL   ?L_MOV_X
   \   000042   78..         MOV     R0,#?V0 + 0
   \   000044   79..         MOV     R1,#?V0 + 12
   \   000046   12....       LCALL   ?UL_DIV_MOD
   \   000049   8C82         MOV     DPL,R4
   \   00004B   8D83         MOV     DPH,R5
   \   00004D   E5..         MOV     A,?V0 + 12
   \   00004F   F0           MOVX    @DPTR,A
    262              tm->minutes = (day % 3600UL) / 60UL;
   \   000050   85....       MOV     ?V0 + 12,?V0 + 8
   \   000053   85....       MOV     ?V0 + 13,?V0 + 9
   \   000056   85....       MOV     ?V0 + 14,?V0 + 10
   \   000059   85....       MOV     ?V0 + 15,?V0 + 11
   \   00005C   90....       MOV     DPTR,#__Constant_e10
   \   00005F   78..         MOV     R0,#?V0 + 0
   \   000061   12....       LCALL   ?L_MOV_X
   \   000064   78..         MOV     R0,#?V0 + 12
   \   000066   79..         MOV     R1,#?V0 + 0
   \   000068   12....       LCALL   ?UL_DIV_MOD
   \   00006B   90....       MOV     DPTR,#__Constant_3c
   \   00006E   78..         MOV     R0,#?V0 + 12
   \   000070   12....       LCALL   ?L_MOV_X
   \   000073   78..         MOV     R0,#?V0 + 0
   \   000075   79..         MOV     R1,#?V0 + 12
   \   000077   12....       LCALL   ?UL_DIV_MOD
   \   00007A   8C82         MOV     DPL,R4
   \   00007C   8D83         MOV     DPH,R5
   \   00007E   A3           INC     DPTR
   \   00007F   E5..         MOV     A,?V0 + 0
   \   000081   F0           MOVX    @DPTR,A
    263              tm->hour = day / 3600UL;
   \   000082   90....       MOV     DPTR,#__Constant_e10
   \   000085   78..         MOV     R0,#?V0 + 0
   \   000087   12....       LCALL   ?L_MOV_X
   \   00008A   78..         MOV     R0,#?V0 + 8
   \   00008C   79..         MOV     R1,#?V0 + 0
   \   00008E   12....       LCALL   ?UL_DIV_MOD
   \   000091   8C82         MOV     DPL,R4
   \   000093   8D83         MOV     DPH,R5
   \   000095   A3           INC     DPTR
   \   000096   A3           INC     DPTR
   \   000097   E5..         MOV     A,?V0 + 8
   \   000099   F0           MOVX    @DPTR,A
    264            }
    265          
    266            // Fill in the calendar - day, month, year
    267            {
    268              uint16 numDays = secTime / DAY;
   \   00009A   90....       MOV     DPTR,#__Constant_15180
   \   00009D   78..         MOV     R0,#?V0 + 0
   \   00009F   12....       LCALL   ?L_MOV_X
   \   0000A2   78..         MOV     R0,#?V0 + 4
   \   0000A4   79..         MOV     R1,#?V0 + 0
   \   0000A6   12....       LCALL   ?UL_DIV_MOD
   \   0000A9   85....       MOV     ?V0 + 0,?V0 + 4
   \   0000AC   85....       MOV     ?V0 + 1,?V0 + 5
    269              tm->year = BEGYEAR;
   \   0000AF   EC           MOV     A,R4
   \   0000B0   2405         ADD     A,#0x5
   \   0000B2   F8           MOV     R0,A
   \   0000B3   ED           MOV     A,R5
   \   0000B4   3400         ADDC    A,#0x0
   \   0000B6   F9           MOV     R1,A
   \   0000B7   88..         MOV     ?V0 + 2,R0
   \   0000B9   89..         MOV     ?V0 + 3,R1
   \   0000BB   8882         MOV     DPL,R0
   \   0000BD   F583         MOV     DPH,A
   \   0000BF   74D0         MOV     A,#-0x30
   \   0000C1   F0           MOVX    @DPTR,A
   \   0000C2   A3           INC     DPTR
   \   0000C3   7407         MOV     A,#0x7
   \   0000C5   F0           MOVX    @DPTR,A
   \   0000C6   7ED0         MOV     R6,#-0x30
   \   0000C8   8024         SJMP    ??osal_ConvertUTCTime_0
    270              while ( numDays >= YearLength( tm->year ) )
    271              {
    272                numDays -= YearLength( tm->year );
   \                     ??osal_ConvertUTCTime_1:
   \   0000CA   786D         MOV     R0,#0x6d
   \                     ??osal_ConvertUTCTime_2:
   \   0000CC   C3           CLR     C
   \   0000CD   E5..         MOV     A,?V0 + 0
   \   0000CF   98           SUBB    A,R0
   \   0000D0   F5..         MOV     ?V0 + 0,A
   \   0000D2   E5..         MOV     A,?V0 + 1
   \   0000D4   9401         SUBB    A,#0x1
   \   0000D6   F5..         MOV     ?V0 + 1,A
    273                tm->year++;
   \   0000D8   85..82       MOV     DPL,?V0 + 2
   \   0000DB   85..83       MOV     DPH,?V0 + 3
   \   0000DE   E0           MOVX    A,@DPTR
   \   0000DF   2401         ADD     A,#0x1
   \   0000E1   F0           MOVX    @DPTR,A
   \   0000E2   A3           INC     DPTR
   \   0000E3   E0           MOVX    A,@DPTR
   \   0000E4   3400         ADDC    A,#0x0
   \   0000E6   F0           MOVX    @DPTR,A
   \   0000E7   EE           MOV     A,R6
   \   0000E8   2401         ADD     A,#0x1
   \   0000EA   0E           INC     R6
   \   0000EB   EF           MOV     A,R7
   \   0000EC   3400         ADDC    A,#0x0
   \                     ??osal_ConvertUTCTime_0:
   \   0000EE   FF           MOV     R7,A
   \   0000EF   EE           MOV     A,R6
   \   0000F0   F8           MOV     R0,A
   \   0000F1   EF           MOV     A,R7
   \   0000F2   F9           MOV     R1,A
   \   0000F3   7A90         MOV     R2,#-0x70
   \   0000F5   7B01         MOV     R3,#0x1
   \   0000F7   12....       LCALL   ?US_DIV_MOD
   \   0000FA   8A..         MOV     ?V0 + 4,R2
   \   0000FC   8B..         MOV     ?V0 + 5,R3
   \   0000FE   EA           MOV     A,R2
   \   0000FF   45..         ORL     A,?V0 + 5
   \   000101   6017         JZ      ??osal_ConvertUTCTime_3
   \   000103   EE           MOV     A,R6
   \   000104   F8           MOV     R0,A
   \   000105   EF           MOV     A,R7
   \   000106   F9           MOV     R1,A
   \   000107   7A64         MOV     R2,#0x64
   \   000109   7B00         MOV     R3,#0x0
   \   00010B   12....       LCALL   ?US_DIV_MOD
   \   00010E   8B..         MOV     ?V0 + 7,R3
   \   000110   EA           MOV     A,R2
   \   000111   45..         ORL     A,?V0 + 7
   \   000113   6009         JZ      ??osal_ConvertUTCTime_4
   \   000115   EE           MOV     A,R6
   \   000116   5403         ANL     A,#0x3
   \   000118   7004         JNZ     ??osal_ConvertUTCTime_4
   \                     ??osal_ConvertUTCTime_3:
   \   00011A   786E         MOV     R0,#0x6e
   \   00011C   8002         SJMP    ??osal_ConvertUTCTime_5
   \                     ??osal_ConvertUTCTime_4:
   \   00011E   786D         MOV     R0,#0x6d
   \                     ??osal_ConvertUTCTime_5:
   \   000120   E5..         MOV     A,?V0 + 0
   \   000122   98           SUBB    A,R0
   \   000123   E5..         MOV     A,?V0 + 1
   \   000125   9401         SUBB    A,#0x1
   \   000127   4021         JC      ??osal_ConvertUTCTime_6
   \   000129   E5..         MOV     A,?V0 + 4
   \   00012B   45..         ORL     A,?V0 + 5
   \   00012D   6017         JZ      ??osal_ConvertUTCTime_7
   \   00012F   EE           MOV     A,R6
   \   000130   F8           MOV     R0,A
   \   000131   EF           MOV     A,R7
   \   000132   F9           MOV     R1,A
   \   000133   7A64         MOV     R2,#0x64
   \   000135   7B00         MOV     R3,#0x0
   \   000137   12....       LCALL   ?US_DIV_MOD
   \   00013A   8B..         MOV     ?V0 + 5,R3
   \   00013C   EA           MOV     A,R2
   \   00013D   45..         ORL     A,?V0 + 5
   \   00013F   6089         JZ      ??osal_ConvertUTCTime_1
   \   000141   EE           MOV     A,R6
   \   000142   5403         ANL     A,#0x3
   \   000144   7084         JNZ     ??osal_ConvertUTCTime_1
   \                     ??osal_ConvertUTCTime_7:
   \   000146   786E         MOV     R0,#0x6e
   \   000148   8082         SJMP    ??osal_ConvertUTCTime_2
    274              }
    275          
    276              tm->month = 0;
   \                     ??osal_ConvertUTCTime_6:
   \   00014A   EC           MOV     A,R4
   \   00014B   2404         ADD     A,#0x4
   \   00014D   F8           MOV     R0,A
   \   00014E   ED           MOV     A,R5
   \   00014F   3400         ADDC    A,#0x0
   \   000151   F9           MOV     R1,A
   \   000152   88..         MOV     ?V0 + 4,R0
   \   000154   89..         MOV     ?V0 + 5,R1
   \   000156   8882         MOV     DPL,R0
   \   000158   F583         MOV     DPH,A
   \   00015A   E4           CLR     A
   \   00015B   F0           MOVX    @DPTR,A
   \   00015C   F5..         MOV     ?V0 + 10,A
   \   00015E   8027         SJMP    ??osal_ConvertUTCTime_8
    277              while ( numDays >= monthLength( IsLeapYear( tm->year ), tm->month ) )
    278              {
   \                     ??osal_ConvertUTCTime_9:
   \   000160   E8           MOV     A,R0
   \   000161   C3           CLR     C
   \   000162   9407         SUBB    A,#0x7
   \   000164   4001         JC      ??osal_ConvertUTCTime_10
   \   000166   18           DEC     R0
   \                     ??osal_ConvertUTCTime_10:
   \   000167   E8           MOV     A,R0
   \   000168   A2E0         MOV     C,0xE0 /* A   */.0
   \   00016A   5003         JNC     ??osal_ConvertUTCTime_11
   \   00016C   75..1E       MOV     ?V0 + 6,#0x1e
    279                numDays -= monthLength( IsLeapYear( tm->year ), tm->month );
   \                     ??osal_ConvertUTCTime_11:
   \   00016F   C3           CLR     C
   \   000170   E5..         MOV     A,?V0 + 0
   \   000172   95..         SUBB    A,?V0 + 6
   \   000174   F5..         MOV     ?V0 + 0,A
   \   000176   E5..         MOV     A,?V0 + 1
   \   000178   9400         SUBB    A,#0x0
   \   00017A   F5..         MOV     ?V0 + 1,A
    280                tm->month++;
   \   00017C   85..82       MOV     DPL,?V0 + 4
   \   00017F   85..83       MOV     DPH,?V0 + 5
   \   000182   E0           MOVX    A,@DPTR
   \   000183   04           INC     A
   \   000184   F0           MOVX    @DPTR,A
   \   000185   05..         INC     ?V0 + 10
   \                     ??osal_ConvertUTCTime_8:
   \   000187   85..82       MOV     DPL,?V0 + 2
   \   00018A   85..83       MOV     DPH,?V0 + 3
   \   00018D   E0           MOVX    A,@DPTR
   \   00018E   FE           MOV     R6,A
   \   00018F   A3           INC     DPTR
   \   000190   E0           MOVX    A,@DPTR
   \   000191   FF           MOV     R7,A
   \   000192   EE           MOV     A,R6
   \   000193   F8           MOV     R0,A
   \   000194   EF           MOV     A,R7
   \   000195   F9           MOV     R1,A
   \   000196   7A90         MOV     R2,#-0x70
   \   000198   7B01         MOV     R3,#0x1
   \   00019A   12....       LCALL   ?US_DIV_MOD
   \   00019D   8A..         MOV     ?V0 + 6,R2
   \   00019F   8B..         MOV     ?V0 + 7,R3
   \   0001A1   EA           MOV     A,R2
   \   0001A2   45..         ORL     A,?V0 + 7
   \   0001A4   6017         JZ      ??osal_ConvertUTCTime_12
   \   0001A6   EE           MOV     A,R6
   \   0001A7   F8           MOV     R0,A
   \   0001A8   EF           MOV     A,R7
   \   0001A9   F9           MOV     R1,A
   \   0001AA   7A64         MOV     R2,#0x64
   \   0001AC   7B00         MOV     R3,#0x0
   \   0001AE   12....       LCALL   ?US_DIV_MOD
   \   0001B1   8B..         MOV     ?V0 + 9,R3
   \   0001B3   EA           MOV     A,R2
   \   0001B4   45..         ORL     A,?V0 + 9
   \   0001B6   6009         JZ      ??osal_ConvertUTCTime_13
   \   0001B8   EE           MOV     A,R6
   \   0001B9   5403         ANL     A,#0x3
   \   0001BB   7004         JNZ     ??osal_ConvertUTCTime_13
   \                     ??osal_ConvertUTCTime_12:
   \   0001BD   7801         MOV     R0,#0x1
   \   0001BF   8002         SJMP    ??osal_ConvertUTCTime_14
   \                     ??osal_ConvertUTCTime_13:
   \   0001C1   7800         MOV     R0,#0x0
   \                     ??osal_ConvertUTCTime_14:
   \   0001C3   85....       MOV     ?V0 + 11,?V0 + 10
   \   0001C6   75..1F       MOV     ?V0 + 8,#0x1f
   \   0001C9   7401         MOV     A,#0x1
   \   0001CB   65..         XRL     A,?V0 + 11
   \   0001CD   7007         JNZ     ??osal_ConvertUTCTime_15
   \   0001CF   741C         MOV     A,#0x1c
   \   0001D1   28           ADD     A,R0
   \   0001D2   F5..         MOV     ?V0 + 8,A
   \   0001D4   8011         SJMP    ??osal_ConvertUTCTime_16
   \                     ??osal_ConvertUTCTime_15:
   \   0001D6   E5..         MOV     A,?V0 + 11
   \   0001D8   9407         SUBB    A,#0x7
   \   0001DA   4002         JC      ??osal_ConvertUTCTime_17
   \   0001DC   15..         DEC     ?V0 + 11
   \                     ??osal_ConvertUTCTime_17:
   \   0001DE   E5..         MOV     A,?V0 + 11
   \   0001E0   A2E0         MOV     C,0xE0 /* A   */.0
   \   0001E2   5003         JNC     ??osal_ConvertUTCTime_16
   \   0001E4   75..1E       MOV     ?V0 + 8,#0x1e
   \                     ??osal_ConvertUTCTime_16:
   \   0001E7   C3           CLR     C
   \   0001E8   E5..         MOV     A,?V0 + 0
   \   0001EA   95..         SUBB    A,?V0 + 8
   \   0001EC   E5..         MOV     A,?V0 + 1
   \   0001EE   9400         SUBB    A,#0x0
   \   0001F0   4038         JC      ??osal_ConvertUTCTime_18
   \   0001F2   E5..         MOV     A,?V0 + 6
   \   0001F4   45..         ORL     A,?V0 + 7
   \   0001F6   6017         JZ      ??osal_ConvertUTCTime_19
   \   0001F8   EE           MOV     A,R6
   \   0001F9   F8           MOV     R0,A
   \   0001FA   EF           MOV     A,R7
   \   0001FB   F9           MOV     R1,A
   \   0001FC   7A64         MOV     R2,#0x64
   \   0001FE   7B00         MOV     R3,#0x0
   \   000200   12....       LCALL   ?US_DIV_MOD
   \   000203   8B..         MOV     ?V0 + 7,R3
   \   000205   EA           MOV     A,R2
   \   000206   45..         ORL     A,?V0 + 7
   \   000208   6009         JZ      ??osal_ConvertUTCTime_20
   \   00020A   EE           MOV     A,R6
   \   00020B   5403         ANL     A,#0x3
   \   00020D   7004         JNZ     ??osal_ConvertUTCTime_20
   \                     ??osal_ConvertUTCTime_19:
   \   00020F   7901         MOV     R1,#0x1
   \   000211   8002         SJMP    ??osal_ConvertUTCTime_21
   \                     ??osal_ConvertUTCTime_20:
   \   000213   7900         MOV     R1,#0x0
   \                     ??osal_ConvertUTCTime_21:
   \   000215   A8..         MOV     R0,?V0 + 10
   \   000217   75..1F       MOV     ?V0 + 6,#0x1f
   \   00021A   7401         MOV     A,#0x1
   \   00021C   68           XRL     A,R0
   \   00021D   6003         JZ      $+5
   \   00021F   02....       LJMP    ??osal_ConvertUTCTime_9 & 0xFFFF
   \   000222   741C         MOV     A,#0x1c
   \   000224   29           ADD     A,R1
   \   000225   F5..         MOV     ?V0 + 6,A
   \   000227   02....       LJMP    ??osal_ConvertUTCTime_11 & 0xFFFF
    281              }
    282          
    283              tm->day = numDays;
   \                     ??osal_ConvertUTCTime_18:
   \   00022A   8C82         MOV     DPL,R4
   \   00022C   8D83         MOV     DPH,R5
   \   00022E   A3           INC     DPTR
   \   00022F   A3           INC     DPTR
   \   000230   A3           INC     DPTR
   \   000231   E5..         MOV     A,?V0 + 0
   \   000233   F0           MOVX    @DPTR,A
    284            }
    285          }
   \   000234   7F10         MOV     R7,#0x10
   \   000236   02....       LJMP    ?BANKED_LEAVE_XDATA
    286          
    287          /*********************************************************************
    288           * @fn      monthLength
    289           *
    290           * @param   lpyr - 1 for leap year, 0 if not
    291           *
    292           * @param   mon - 0 - 11 (jan - dec)
    293           *
    294           * @return  number of days in specified month
    295           */
    296          static uint8 monthLength( uint8 lpyr, uint8 mon )
    297          {
    298            uint8 days = 31;
    299          
    300          	if ( mon == 1 ) // feb
    301            {
    302          		days = ( 28 + lpyr );
    303            }
    304            else
    305            {
    306              if ( mon > 6 ) // aug-dec
    307              {
    308                mon--;
    309              }
    310          
    311              if ( mon & 1 )
    312              {
    313                days = 30;
    314              }
    315            }
    316          
    317          	return ( days );
    318          }
    319          
    320          /*********************************************************************
    321           * @fn      osal_ConvertUTCSecs
    322           *
    323           * @brief   Converts a UTCTimeStruct to UTCTime
    324           *
    325           * @param   tm - pointer to provided struct
    326           *
    327           * @return  number of seconds since 00:00:00 on 01/01/2000 (UTC)
    328           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    329          UTCTime osal_ConvertUTCSecs( UTCTimeStruct *tm )
   \                     osal_ConvertUTCSecs:
    330          {
   \   000000   74EC         MOV     A,#-0x14
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 20
   \   000005                ; Auto size: 0
    331            uint32 seconds;
    332          
    333            /* Seconds for the partial day */
    334            seconds = (((tm->hour * 60UL) + tm->minutes) * 60UL) + tm->seconds;
   \   000005   8A82         MOV     DPL,R2
   \   000007   8B83         MOV     DPH,R3
   \   000009   A3           INC     DPTR
   \   00000A   A3           INC     DPTR
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F5..         MOV     ?V0 + 4,A
   \   00000E   E4           CLR     A
   \   00000F   F5..         MOV     ?V0 + 5,A
   \   000011   F5..         MOV     ?V0 + 6,A
   \   000013   F5..         MOV     ?V0 + 7,A
   \   000015   90....       MOV     DPTR,#__Constant_3c
   \   000018   78..         MOV     R0,#?V0 + 0
   \   00001A   12....       LCALL   ?L_MOV_X
   \   00001D   78..         MOV     R0,#?V0 + 4
   \   00001F   79..         MOV     R1,#?V0 + 0
   \   000021   12....       LCALL   ?L_MUL
   \   000024   8A82         MOV     DPL,R2
   \   000026   8B83         MOV     DPH,R3
   \   000028   A3           INC     DPTR
   \   000029   12....       LCALL   ?Subroutine0 & 0xFFFF
   \                     ??CrossCallReturnLabel_0:
   \   00002C   12....       LCALL   ?L_ADD
   \   00002F   90....       MOV     DPTR,#__Constant_3c
   \   000032   78..         MOV     R0,#?V0 + 0
   \   000034   12....       LCALL   ?L_MOV_X
   \   000037   78..         MOV     R0,#?V0 + 4
   \   000039   79..         MOV     R1,#?V0 + 0
   \   00003B   12....       LCALL   ?L_MUL
   \   00003E   8A82         MOV     DPL,R2
   \   000040   8B83         MOV     DPH,R3
   \   000042   12....       LCALL   ?Subroutine0 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   000045   12....       LCALL   ?L_ADD
    335          
    336            /* Account for previous complete days */
    337            {
    338              /* Start with complete days in current month */
    339              uint16 days = tm->day;
   \   000048   A3           INC     DPTR
   \   000049   A3           INC     DPTR
   \   00004A   A3           INC     DPTR
   \   00004B   E0           MOVX    A,@DPTR
   \   00004C   F5..         MOV     ?V0 + 0,A
    340          
    341              /* Next, complete months in current year */
    342              {
    343                int8 month = tm->month;
   \   00004E   8A82         MOV     DPL,R2
   \   000050   8B83         MOV     DPH,R3
   \   000052   A3           INC     DPTR
   \   000053   A3           INC     DPTR
   \   000054   A3           INC     DPTR
   \   000055   A3           INC     DPTR
   \   000056   E0           MOVX    A,@DPTR
   \   000057   14           DEC     A
   \   000058   FF           MOV     R7,A
   \   000059   8A82         MOV     DPL,R2
   \   00005B   8B83         MOV     DPH,R3
   \   00005D   A3           INC     DPTR
   \   00005E   A3           INC     DPTR
   \   00005F   A3           INC     DPTR
   \   000060   A3           INC     DPTR
   \   000061   A3           INC     DPTR
   \   000062   E0           MOVX    A,@DPTR
   \   000063   FC           MOV     R4,A
   \   000064   A3           INC     DPTR
   \   000065   E0           MOVX    A,@DPTR
   \   000066   FD           MOV     R5,A
   \   000067   EF           MOV     A,R7
   \   000068   C3           CLR     C
   \   000069   9400         SUBB    A,#0x0
   \   00006B   A2D2         MOV     C,0xD0 /* PSW */.2
   \   00006D   65D0         XRL     A,PSW
   \   00006F   33           RLC     A
   \   000070   4075         JC      ??osal_ConvertUTCSecs_0
   \   000072   EC           MOV     A,R4
   \   000073   5403         ANL     A,#0x3
   \   000075   F5..         MOV     ?V0 + 10,A
   \   000077   EC           MOV     A,R4
   \   000078   F8           MOV     R0,A
   \   000079   ED           MOV     A,R5
   \   00007A   F9           MOV     R1,A
   \   00007B   7A64         MOV     R2,#0x64
   \   00007D   7B00         MOV     R3,#0x0
   \   00007F   12....       LCALL   ?US_DIV_MOD
   \   000082   8A..         MOV     ?V0 + 2,R2
   \   000084   8B..         MOV     ?V0 + 3,R3
   \   000086   EC           MOV     A,R4
   \   000087   F8           MOV     R0,A
   \   000088   ED           MOV     A,R5
   \   000089   F9           MOV     R1,A
   \   00008A   7A90         MOV     R2,#-0x70
   \   00008C   7B01         MOV     R3,#0x1
   \   00008E   12....       LCALL   ?US_DIV_MOD
   \   000091   8A..         MOV     ?V0 + 8,R2
   \   000093   8B..         MOV     ?V0 + 9,R3
   \   000095   A8..         MOV     R0,?V0 + 8
   \   000097   A9..         MOV     R1,?V0 + 9
    344                while ( --month >= 0 )
    345                {
    346                  days += monthLength( IsLeapYear( tm->year ), month );
   \                     ??osal_ConvertUTCSecs_1:
   \   000099   E8           MOV     A,R0
   \   00009A   49           ORL     A,R1
   \   00009B   600A         JZ      ??osal_ConvertUTCSecs_2
   \   00009D   E5..         MOV     A,?V0 + 2
   \   00009F   45..         ORL     A,?V0 + 3
   \   0000A1   6008         JZ      ??osal_ConvertUTCSecs_3
   \   0000A3   E5..         MOV     A,?V0 + 10
   \   0000A5   7004         JNZ     ??osal_ConvertUTCSecs_3
   \                     ??osal_ConvertUTCSecs_2:
   \   0000A7   7A01         MOV     R2,#0x1
   \   0000A9   8002         SJMP    ??osal_ConvertUTCSecs_4
   \                     ??osal_ConvertUTCSecs_3:
   \   0000AB   7A00         MOV     R2,#0x0
   \                     ??osal_ConvertUTCSecs_4:
   \   0000AD   EF           MOV     A,R7
   \   0000AE   FE           MOV     R6,A
   \   0000AF   75..1F       MOV     ?V0 + 8,#0x1f
   \   0000B2   7401         MOV     A,#0x1
   \   0000B4   6E           XRL     A,R6
   \   0000B5   7007         JNZ     ??osal_ConvertUTCSecs_5
   \   0000B7   741C         MOV     A,#0x1c
   \   0000B9   2A           ADD     A,R2
   \   0000BA   F5..         MOV     ?V0 + 8,A
   \   0000BC   800F         SJMP    ??osal_ConvertUTCSecs_6
   \                     ??osal_ConvertUTCSecs_5:
   \   0000BE   EE           MOV     A,R6
   \   0000BF   C3           CLR     C
   \   0000C0   9407         SUBB    A,#0x7
   \   0000C2   4001         JC      ??osal_ConvertUTCSecs_7
   \   0000C4   1E           DEC     R6
   \                     ??osal_ConvertUTCSecs_7:
   \   0000C5   EE           MOV     A,R6
   \   0000C6   A2E0         MOV     C,0xE0 /* A   */.0
   \   0000C8   5003         JNC     ??osal_ConvertUTCSecs_6
   \   0000CA   75..1E       MOV     ?V0 + 8,#0x1e
    347                }
   \                     ??osal_ConvertUTCSecs_6:
   \   0000CD   E5..         MOV     A,?V0 + 0
   \   0000CF   25..         ADD     A,?V0 + 8
   \   0000D1   F5..         MOV     ?V0 + 0,A
   \   0000D3   E5..         MOV     A,?V0 + 1
   \   0000D5   3400         ADDC    A,#0x0
   \   0000D7   F5..         MOV     ?V0 + 1,A
   \   0000D9   74FF         MOV     A,#-0x1
   \   0000DB   2F           ADD     A,R7
   \   0000DC   1F           DEC     R7
   \   0000DD   C3           CLR     C
   \   0000DE   9400         SUBB    A,#0x0
   \   0000E0   A2D2         MOV     C,0xD0 /* PSW */.2
   \   0000E2   65D0         XRL     A,PSW
   \   0000E4   33           RLC     A
   \   0000E5   50B2         JNC     ??osal_ConvertUTCSecs_1
    348              }
    349          
    350              /* Next, complete years before current year */
    351              {
    352                uint16 year = tm->year;
   \                     ??osal_ConvertUTCSecs_0:
   \   0000E7   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_3:
   \   0000EA   403F         JC      ??osal_ConvertUTCSecs_8
    353                while ( --year >= BEGYEAR )
    354                {
    355                  days += YearLength( year );
   \                     ??osal_ConvertUTCSecs_9:
   \   0000EC   EC           MOV     A,R4
   \   0000ED   F8           MOV     R0,A
   \   0000EE   ED           MOV     A,R5
   \   0000EF   F9           MOV     R1,A
   \   0000F0   7A90         MOV     R2,#-0x70
   \   0000F2   7B01         MOV     R3,#0x1
   \   0000F4   12....       LCALL   ?US_DIV_MOD
   \   0000F7   8B..         MOV     ?V0 + 3,R3
   \   0000F9   EA           MOV     A,R2
   \   0000FA   45..         ORL     A,?V0 + 3
   \   0000FC   6017         JZ      ??osal_ConvertUTCSecs_10
   \   0000FE   EC           MOV     A,R4
   \   0000FF   F8           MOV     R0,A
   \   000100   ED           MOV     A,R5
   \   000101   F9           MOV     R1,A
   \   000102   7A64         MOV     R2,#0x64
   \   000104   7B00         MOV     R3,#0x0
   \   000106   12....       LCALL   ?US_DIV_MOD
   \   000109   8B..         MOV     ?V0 + 3,R3
   \   00010B   EA           MOV     A,R2
   \   00010C   45..         ORL     A,?V0 + 3
   \   00010E   6009         JZ      ??osal_ConvertUTCSecs_11
   \   000110   EC           MOV     A,R4
   \   000111   5403         ANL     A,#0x3
   \   000113   7004         JNZ     ??osal_ConvertUTCSecs_11
   \                     ??osal_ConvertUTCSecs_10:
   \   000115   786E         MOV     R0,#0x6e
   \   000117   8002         SJMP    ??osal_ConvertUTCSecs_12
   \                     ??osal_ConvertUTCSecs_11:
   \   000119   786D         MOV     R0,#0x6d
   \                     ??osal_ConvertUTCSecs_12:
   \   00011B   E5..         MOV     A,?V0 + 0
   \   00011D   28           ADD     A,R0
   \   00011E   F5..         MOV     ?V0 + 0,A
   \   000120   E5..         MOV     A,?V0 + 1
   \   000122   3401         ADDC    A,#0x1
   \   000124   F5..         MOV     ?V0 + 1,A
   \   000126   12....       LCALL   ?Subroutine1 & 0xFFFF
    356                }
    357              }
   \                     ??CrossCallReturnLabel_2:
   \   000129   50C1         JNC     ??osal_ConvertUTCSecs_9
    358          
    359              /* Add total seconds before partial day */
    360              seconds += (days * DAY);
    361            }
    362          
    363            return ( seconds );
   \                     ??osal_ConvertUTCSecs_8:
   \   00012B   E4           CLR     A
   \   00012C   F5..         MOV     ?V0 + 2,A
   \   00012E   F5..         MOV     ?V0 + 3,A
   \   000130   90....       MOV     DPTR,#__Constant_15180
   \   000133   78..         MOV     R0,#?V0 + 8
   \   000135   12....       LCALL   ?L_MOV_X
   \   000138   78..         MOV     R0,#?V0 + 0
   \   00013A   79..         MOV     R1,#?V0 + 8
   \   00013C   12....       LCALL   ?L_MUL
   \   00013F   78..         MOV     R0,#?V0 + 4
   \   000141   79..         MOV     R1,#?V0 + 0
   \   000143   12....       LCALL   ?L_ADD
   \   000146   AA..         MOV     R2,?V0 + 4
   \   000148   AB..         MOV     R3,?V0 + 5
   \   00014A   AC..         MOV     R4,?V0 + 6
   \   00014C   AD..         MOV     R5,?V0 + 7
   \   00014E   7F0C         MOV     R7,#0xc
   \   000150   02....       LJMP    ?BANKED_LEAVE_XDATA
    364          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   EC           MOV     A,R4
   \   000001   24FF         ADD     A,#-0x1
   \   000003   1C           DEC     R4
   \   000004   ED           MOV     A,R5
   \   000005   34FF         ADDC    A,#-0x1
   \   000007   FD           MOV     R5,A
   \   000008   C3           CLR     C
   \   000009   EC           MOV     A,R4
   \   00000A   94D0         SUBB    A,#-0x30
   \   00000C   ED           MOV     A,R5
   \   00000D   9407         SUBB    A,#0x7
   \   00000F   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F5..         MOV     ?V0 + 0,A
   \   000003   E4           CLR     A
   \   000004   F5..         MOV     ?V0 + 1,A
   \   000006   F5..         MOV     ?V0 + 2,A
   \   000008   F5..         MOV     ?V0 + 3,A
   \   00000A   78..         MOV     R0,#?V0 + 4
   \   00000C   79..         MOV     R1,#?V0 + 0
   \   00000E   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   90....       MOV     DPTR,#timeMSec
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F8           MOV     R0,A
   \   000005   A3           INC     DPTR
   \   000006   E0           MOVX    A,@DPTR
   \   000007   F9           MOV     R1,A
   \   000008   7AE8         MOV     R2,#-0x18
   \   00000A   7B03         MOV     R3,#0x3
   \   00000C   22           RET

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_15180:
   \   000000   80510100     DD 86400

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3c:
   \   000000   3C000000     DD 60

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_e10:
   \   000000   100E0000     DD 3600

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??osalTimeUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    osalTimeUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??osal_setClock?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    osal_setClock

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??osal_getClock?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    osal_getClock

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??osal_ConvertUTCTime?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    osal_ConvertUTCTime

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??osal_ConvertUTCSecs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    osal_ConvertUTCSecs

   Maximum stack usage in bytes:

     Function                     ISTACK PSTACK XSTACK
     --------                     ------ ------ ------
     osalTimeUpdate                   0      0     18
       -> macMcuPrecisionCount        0      0     32
       -> osalMcuDivide31By16To16     0      0     36
       -> osalTimerUpdate             0      0     32
     osal_ConvertUTCSecs              0      0     20
     osal_ConvertUTCTime              1      0     28
     osal_getClock                    2      0      0
     osal_setClock                    0      0     12


   Segment part sizes:

     Function/Label              Bytes
     --------------              -----
     _A_IEN0                        1
     previousMacTimerTick           4
     remUsTicks                     2
     timeMSec                       2
     OSAL_timeSeconds               4
     osalTimeUpdate               198
     osal_setClock                 26
     osal_getClock                 17
     osal_ConvertUTCTime          569
     osal_ConvertUTCSecs          339
     ?Subroutine1                  16
     ?Subroutine0                  15
     ?Subroutine2                  13
     __Constant_15180               4
     __Constant_3c                  4
     __Constant_e10                 4
     ??osalTimeUpdate?relay         6
     ??osal_setClock?relay          6
     ??osal_getClock?relay          6
     ??osal_ConvertUTCTime?relay    6
     ??osal_ConvertUTCSecs?relay    6

 
 1 193 bytes in segment BANKED_CODE
    30 bytes in segment BANK_RELAYS
     1 byte  in segment SFR_AN
    12 bytes in segment XDATA_ROM_C
    12 bytes in segment XDATA_Z
 
 1 223 bytes of CODE  memory
     0 bytes of CONST memory (+ 12 bytes shared)
     0 bytes of DATA  memory (+  1 byte  shared)
    12 bytes of XDATA memory

Errors: none
Warnings: none
